# VidFab AI - 独立 Redis 服务
# 用途: 提供独立的 Redis 服务，可被多个应用共享
# 启动: docker compose -f docker-compose-redis.yml up -d
# 停止: docker compose -f docker-compose-redis.yml down

services:
  # Redis service for queue management
  redis:
    image: redis:7-alpine
    container_name: vidfab-redis-standalone
    restart: unless-stopped
    ports:
      - "${REDIS_PORT:-6379}:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes --maxmemory 256mb --maxmemory-policy allkeys-lru
    healthcheck:
      test: ["CMD", "redis-cli", "ping"]
      interval: 30s
      timeout: 3s
      retries: 3
    networks:
      - vidfab-network

  # Redis Commander (optional, for Redis GUI management)
  redis-commander:
    image: ghcr.io/joeferner/redis-commander:latest
    container_name: vidfab-redis-commander
    restart: unless-stopped
    environment:
      - REDIS_HOSTS=local:redis:6379
      - HTTP_USER=${REDIS_COMMANDER_USER:-admin}
      - HTTP_PASSWORD=${REDIS_COMMANDER_PASSWORD:-admin123}
    ports:
      - "${REDIS_COMMANDER_PORT:-8081}:8081"
    depends_on:
      - redis
    networks:
      - vidfab-network
    profiles:
      - debug  # Only start with --profile debug

# Named volumes for data persistence
volumes:
  redis_data:
    driver: local

# Custom network for service communication
networks:
  vidfab-network:
    name: vidfab-network
    driver: bridge
