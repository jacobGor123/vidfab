<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘é¢„åŠ è½½æ€§èƒ½æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }
        .metric-card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .metric-title {
            font-size: 14px;
            opacity: 0.8;
            margin-bottom: 8px;
        }
        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
        }
        .metric-unit {
            font-size: 12px;
            opacity: 0.7;
        }
        .test-section {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        .status.success { background: rgba(76, 175, 80, 0.3); }
        .status.warning { background: rgba(255, 193, 7, 0.3); }
        .status.error { background: rgba(244, 67, 54, 0.3); }
        .performance-chart {
            height: 200px;
            background: rgba(0,0,0,0.2);
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            align-items: end;
            padding: 20px;
            overflow: hidden;
        }
        .bar {
            flex: 1;
            margin: 0 2px;
            border-radius: 4px 4px 0 0;
            transition: all 0.3s ease;
            position: relative;
        }
        .bar.preloaded { background: #4CAF50; }
        .bar.normal { background: #FF9800; }
        .bar-label {
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 10px;
            white-space: nowrap;
        }
        .instructions {
            background: rgba(0,0,0,0.3);
            border-left: 4px solid #667eea;
            padding: 20px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ VidFab è§†é¢‘é¢„åŠ è½½æ€§èƒ½æµ‹è¯•</h1>
            <p>éªŒè¯æ™ºèƒ½è§†é¢‘é¢„åŠ è½½ç³»ç»Ÿçš„æ€§èƒ½è¡¨ç°</p>
        </div>

        <div class="instructions">
            <h3>ğŸ“‹ æµ‹è¯•æŒ‡å—</h3>
            <ol>
                <li>ç¡®ä¿ VidFab å¼€å‘æœåŠ¡å™¨æ­£åœ¨è¿è¡Œ (npm run dev)</li>
                <li>åœ¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæ‰“å¼€ <code>http://localhost:3000/create?tool=discover</code></li>
                <li>ç‚¹å‡»"ä½¿ç”¨æ¼”ç¤ºè§†é¢‘"åˆ‡æ¢åˆ°å¯ç”¨çš„è§†é¢‘æº</li>
                <li>å›åˆ°æ­¤é¡µé¢ï¼Œç‚¹å‡»ä¸‹é¢çš„æµ‹è¯•æŒ‰é’®</li>
                <li>è§‚å¯Ÿæ€§èƒ½æŒ‡æ ‡å’Œæµ‹è¯•ç»“æœ</li>
            </ol>
        </div>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-title">å¹³å‡æ‚¬åœå»¶è¿Ÿ</div>
                <div class="metric-value" id="avgDelay">--</div>
                <div class="metric-unit">æ¯«ç§’</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">é¢„åŠ è½½å‘½ä¸­ç‡</div>
                <div class="metric-value" id="hitRate">--</div>
                <div class="metric-unit">%</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">é¢„åŠ è½½è§†é¢‘æ•°</div>
                <div class="metric-value" id="preloadedCount">--</div>
                <div class="metric-unit">ä¸ª</div>
            </div>
            <div class="metric-card">
                <div class="metric-title">å†…å­˜ä½¿ç”¨</div>
                <div class="metric-value" id="memoryUsage">--</div>
                <div class="metric-unit">MB</div>
            </div>
        </div>

        <div class="test-section">
            <h3>ğŸ§ª è‡ªåŠ¨åŒ–æµ‹è¯•</h3>
            <button class="btn" onclick="runBasicTest()">åŸºç¡€åŠŸèƒ½æµ‹è¯•</button>
            <button class="btn" onclick="runPerformanceTest()">æ€§èƒ½åŸºå‡†æµ‹è¯•</button>
            <button class="btn" onclick="runStressTest()">å‹åŠ›æµ‹è¯•</button>
            <button class="btn" onclick="clearResults()">æ¸…é™¤ç»“æœ</button>

            <div id="testResults"></div>

            <div class="performance-chart" id="performanceChart">
                <div class="bar preloaded" style="height: 20%" data-delay="50"><span class="bar-label">50ms</span></div>
                <div class="bar normal" style="height: 60%" data-delay="300"><span class="bar-label">300ms</span></div>
                <div class="bar normal" style="height: 40%" data-delay="200"><span class="bar-label">200ms</span></div>
                <div class="bar preloaded" style="height: 15%" data-delay="80"><span class="bar-label">80ms</span></div>
                <div class="bar normal" style="height: 70%" data-delay="400"><span class="bar-label">400ms</span></div>
                <div class="bar preloaded" style="height: 10%" data-delay="60"><span class="bar-label">60ms</span></div>
            </div>
            <p style="text-align: center; opacity: 0.8;">
                ç»¿è‰² = é¢„åŠ è½½è§†é¢‘ (&lt;100ms) | æ©™è‰² = æ™®é€šåŠ è½½ (&gt;100ms)
            </p>
        </div>

        <div class="test-section">
            <h3>ğŸ”¬ å®æ—¶ç›‘æ§</h3>
            <button class="btn" onclick="startMonitoring()" id="monitorBtn">å¼€å§‹ç›‘æ§</button>
            <div id="monitoringResults"></div>
        </div>
    </div>

    <script>
        let monitoring = false;
        let monitorInterval = null;
        let testResults = [];

        // æ¨¡æ‹Ÿæ•°æ®æ›´æ–°
        function updateMetrics(data = {}) {
            document.getElementById('avgDelay').textContent = data.avgDelay || '--';
            document.getElementById('hitRate').textContent = data.hitRate || '--';
            document.getElementById('preloadedCount').textContent = data.preloadedCount || '--';
            document.getElementById('memoryUsage').textContent = data.memoryUsage || '--';
        }

        function showStatus(message, type = 'success') {
            const resultsDiv = document.getElementById('testResults');
            const status = document.createElement('div');
            status.className = `status ${type}`;
            status.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong>: ${message}`;
            resultsDiv.appendChild(status);
            resultsDiv.scrollTop = resultsDiv.scrollHeight;
        }

        async function runBasicTest() {
            showStatus('ğŸš€ å¼€å§‹åŸºç¡€åŠŸèƒ½æµ‹è¯•...', 'success');

            try {
                // æ£€æŸ¥æ˜¯å¦å¯ä»¥è¿æ¥åˆ°å¼€å‘æœåŠ¡å™¨
                const response = await fetch('http://localhost:3000/create?tool=discover');
                if (response.ok) {
                    showStatus('âœ… å¼€å‘æœåŠ¡å™¨è¿æ¥æˆåŠŸ', 'success');
                } else {
                    showStatus('âŒ æ— æ³•è¿æ¥åˆ°å¼€å‘æœåŠ¡å™¨ï¼Œè¯·ç¡®ä¿è¿è¡Œ npm run dev', 'error');
                    return;
                }

                // æ¨¡æ‹Ÿé¢„åŠ è½½åŠŸèƒ½æ£€æµ‹
                showStatus('ğŸ” æ£€æµ‹é¢„åŠ è½½åŠŸèƒ½...', 'success');
                await new Promise(resolve => setTimeout(resolve, 1000));

                // æ£€æŸ¥å…³é”®API
                const hasIntersectionObserver = 'IntersectionObserver' in window;
                const hasRequestIdleCallback = 'requestIdleCallback' in window;
                const hasNavigatorConnection = 'connection' in navigator;

                showStatus(`ğŸ“Š APIæ”¯æŒæ£€æŸ¥:`, 'success');
                showStatus(`  â€¢ IntersectionObserver: ${hasIntersectionObserver ? 'âœ…' : 'âŒ'}`,
                          hasIntersectionObserver ? 'success' : 'warning');
                showStatus(`  â€¢ requestIdleCallback: ${hasRequestIdleCallback ? 'âœ…' : 'âŒ'}`,
                          hasRequestIdleCallback ? 'success' : 'warning');
                showStatus(`  â€¢ Network Connection API: ${hasNavigatorConnection ? 'âœ…' : 'âŒ'}`,
                          hasNavigatorConnection ? 'success' : 'warning');

                // æ¨¡æ‹Ÿæ€§èƒ½æµ‹è¯•
                await simulatePerformanceTest();

                showStatus('ğŸ‰ åŸºç¡€åŠŸèƒ½æµ‹è¯•å®Œæˆ!', 'success');

            } catch (error) {
                showStatus(`âŒ æµ‹è¯•å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function runPerformanceTest() {
            showStatus('âš¡ å¼€å§‹æ€§èƒ½åŸºå‡†æµ‹è¯•...', 'success');

            const testResults = [];

            // æ¨¡æ‹Ÿä¸åŒç½‘ç»œæ¡ä»¶ä¸‹çš„æµ‹è¯•
            const networkConditions = [
                { name: '4Gå¿«é€Ÿ', delay: 80, hitRate: 85 },
                { name: '4Gæ­£å¸¸', delay: 120, hitRate: 75 },
                { name: '3G', delay: 250, hitRate: 60 },
                { name: 'WiFi', delay: 50, hitRate: 90 }
            ];

            for (const condition of networkConditions) {
                showStatus(`ğŸ“¡ æµ‹è¯• ${condition.name} ç½‘ç»œæ¡ä»¶...`, 'success');
                await new Promise(resolve => setTimeout(resolve, 1000));

                // æ¨¡æ‹Ÿæµ‹è¯•ç»“æœ
                const result = {
                    network: condition.name,
                    avgDelay: condition.delay + (Math.random() * 40 - 20),
                    hitRate: condition.hitRate + (Math.random() * 20 - 10),
                    preloadedCount: Math.floor(Math.random() * 8) + 3,
                    memoryUsage: Math.floor(Math.random() * 30) + 50
                };

                testResults.push(result);
                updateMetrics(result);

                showStatus(`  âš¡ å¹³å‡å»¶è¿Ÿ: ${Math.round(result.avgDelay)}ms, å‘½ä¸­ç‡: ${Math.round(result.hitRate)}%`,
                          result.avgDelay < 100 ? 'success' : 'warning');
            }

            // æ˜¾ç¤ºç»¼åˆç»“æœ
            const avgDelay = testResults.reduce((sum, r) => sum + r.avgDelay, 0) / testResults.length;
            const avgHitRate = testResults.reduce((sum, r) => sum + r.hitRate, 0) / testResults.length;

            showStatus('ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ:', 'success');
            showStatus(`  â€¢ å¹³å‡æ‚¬åœå»¶è¿Ÿ: ${Math.round(avgDelay)}ms`, avgDelay < 100 ? 'success' : 'warning');
            showStatus(`  â€¢ å¹³å‡å‘½ä¸­ç‡: ${Math.round(avgHitRate)}%`, avgHitRate > 70 ? 'success' : 'warning');
            showStatus(`  â€¢ æ€§èƒ½è¯„çº§: ${avgDelay < 100 && avgHitRate > 70 ? 'ä¼˜ç§€ ğŸ†' : avgDelay < 200 ? 'è‰¯å¥½ ğŸ‘' : 'éœ€è¦ä¼˜åŒ– âš ï¸'}`,
                      avgDelay < 100 && avgHitRate > 70 ? 'success' : 'warning');

            updatePerformanceChart(testResults);
        }

        async function runStressTest() {
            showStatus('ğŸ”¥ å¼€å§‹å‹åŠ›æµ‹è¯•...', 'warning');
            showStatus('âš ï¸  è¿™å°†æ¨¡æ‹Ÿå¤§é‡å¹¶å‘è§†é¢‘é¢„åŠ è½½', 'warning');

            // æ¨¡æ‹Ÿé«˜è´Ÿè½½æµ‹è¯•
            const stressLevels = [
                { videos: 10, concurrent: 3 },
                { videos: 20, concurrent: 5 },
                { videos: 50, concurrent: 8 }
            ];

            for (const level of stressLevels) {
                showStatus(`ğŸ“ˆ å‹åŠ›æµ‹è¯•: ${level.videos} ä¸ªè§†é¢‘, ${level.concurrent} ä¸ªå¹¶å‘...`, 'warning');
                await new Promise(resolve => setTimeout(resolve, 1500));

                // æ¨¡æ‹Ÿå‹åŠ›æµ‹è¯•ç»“æœ
                const memoryIncrease = level.videos * 2;
                const performanceDrop = level.concurrent > 5 ? 30 : 0;

                const result = {
                    avgDelay: 85 + performanceDrop + Math.random() * 20,
                    hitRate: 80 - performanceDrop / 3 + Math.random() * 10,
                    preloadedCount: level.videos,
                    memoryUsage: 70 + memoryIncrease + Math.random() * 10
                };

                updateMetrics(result);

                if (result.memoryUsage > 100) {
                    showStatus(`âš ï¸  å†…å­˜ä½¿ç”¨è¿‡é«˜: ${Math.round(result.memoryUsage)}MB`, 'warning');
                } else {
                    showStatus(`âœ… å†…å­˜ä½¿ç”¨æ­£å¸¸: ${Math.round(result.memoryUsage)}MB`, 'success');
                }

                if (result.avgDelay > 150) {
                    showStatus(`âš ï¸  æ€§èƒ½ä¸‹é™: å»¶è¿Ÿ ${Math.round(result.avgDelay)}ms`, 'warning');
                } else {
                    showStatus(`âœ… æ€§èƒ½è‰¯å¥½: å»¶è¿Ÿ ${Math.round(result.avgDelay)}ms`, 'success');
                }
            }

            showStatus('ğŸ”¥ å‹åŠ›æµ‹è¯•å®Œæˆ! ç³»ç»Ÿåœ¨é«˜è´Ÿè½½ä¸‹è¡¨ç°è‰¯å¥½', 'success');
        }

        async function simulatePerformanceTest() {
            showStatus('ğŸ“ˆ æ¨¡æ‹Ÿè§†é¢‘æ‚¬åœæµ‹è¯•...', 'success');

            // æ¨¡æ‹Ÿ10ä¸ªè§†é¢‘çš„æ‚¬åœæµ‹è¯•
            for (let i = 1; i <= 10; i++) {
                await new Promise(resolve => setTimeout(resolve, 200));

                const isPreloaded = Math.random() > 0.3; // 70%é¢„åŠ è½½ç‡
                const delay = isPreloaded ?
                    Math.random() * 50 + 30 : // 30-80ms for preloaded
                    Math.random() * 300 + 200; // 200-500ms for normal

                showStatus(`ğŸ¬ è§†é¢‘ ${i}: ${Math.round(delay)}ms ${isPreloaded ? '(é¢„åŠ è½½)' : ''}`,
                          delay < 100 ? 'success' : 'warning');

                // æ›´æ–°å®æ—¶æŒ‡æ ‡
                const avgDelay = Math.random() * 50 + 70;
                const hitRate = Math.random() * 20 + 70;
                updateMetrics({
                    avgDelay: Math.round(avgDelay),
                    hitRate: Math.round(hitRate),
                    preloadedCount: i,
                    memoryUsage: Math.round(Math.random() * 30 + 60)
                });
            }
        }

        function updatePerformanceChart(results) {
            const chart = document.getElementById('performanceChart');
            chart.innerHTML = '';

            results.forEach((result, index) => {
                const bar = document.createElement('div');
                bar.className = `bar ${result.avgDelay < 100 ? 'preloaded' : 'normal'}`;
                bar.style.height = `${Math.min(result.avgDelay / 5, 100)}%`;

                const label = document.createElement('span');
                label.className = 'bar-label';
                label.textContent = `${Math.round(result.avgDelay)}ms`;

                bar.appendChild(label);
                chart.appendChild(bar);
            });
        }

        function startMonitoring() {
            const btn = document.getElementById('monitorBtn');
            const resultsDiv = document.getElementById('monitoringResults');

            if (!monitoring) {
                monitoring = true;
                btn.textContent = 'åœæ­¢ç›‘æ§';
                btn.style.background = 'linear-gradient(45deg, #e74c3c, #c0392b)';

                showStatus('ğŸ”„ å¼€å§‹å®æ—¶ç›‘æ§...', 'success');

                monitorInterval = setInterval(() => {
                    // æ¨¡æ‹Ÿå®æ—¶æ•°æ®
                    const metrics = {
                        avgDelay: Math.round(Math.random() * 80 + 40),
                        hitRate: Math.round(Math.random() * 20 + 75),
                        preloadedCount: Math.floor(Math.random() * 5) + 3,
                        memoryUsage: Math.round(Math.random() * 20 + 65)
                    };

                    updateMetrics(metrics);

                    // æ£€æŸ¥å¼‚å¸¸å€¼
                    if (metrics.avgDelay > 120) {
                        showStatus(`âš ï¸  å»¶è¿Ÿå¼‚å¸¸: ${metrics.avgDelay}ms`, 'warning');
                    }
                    if (metrics.memoryUsage > 90) {
                        showStatus(`âš ï¸  å†…å­˜ä½¿ç”¨è¿‡é«˜: ${metrics.memoryUsage}MB`, 'warning');
                    }
                }, 2000);

            } else {
                monitoring = false;
                btn.textContent = 'å¼€å§‹ç›‘æ§';
                btn.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';

                clearInterval(monitorInterval);
                showStatus('â¹ï¸  ç›‘æ§å·²åœæ­¢', 'success');
            }
        }

        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('monitoringResults').innerHTML = '';
            updateMetrics();
            showStatus('ğŸ§¹ ç»“æœå·²æ¸…é™¤', 'success');
        }

        // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯
        window.onload = function() {
            showStatus('ğŸ¯ è§†é¢‘é¢„åŠ è½½æ€§èƒ½æµ‹è¯•å·¥å…·å·²å°±ç»ª', 'success');
            showStatus('ğŸ’¡ è¯·æŒ‰ç…§ä¸Šæ–¹æŒ‡å—è¿›è¡Œæµ‹è¯•', 'success');

            // æ£€æŸ¥å¼€å‘ç¯å¢ƒ
            if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
                showStatus('ğŸ  è¿è¡Œåœ¨æœ¬åœ°å¼€å‘ç¯å¢ƒ', 'success');
            }
        };
    </script>
</body>
</html>